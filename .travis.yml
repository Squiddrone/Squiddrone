notifications:
  email: false

sudo: false

language: c

matrix:
  fast_finish: true
  include:
    - name: 9-2019-q4
      env: GCC_URL="https://developer.arm.com/-/media/Files/downloads/gnu-rm/9-2019q4/RC2.1/gcc-arm-none-eabi-9-2019-q4-major-x86_64-linux.tar.bz2?revision=6e63531f-8cb1-40b9-bbfc-8a57cdfc01b4&la=en&hash=F761343D43A0587E8AC0925B723C04DBFB848339"

addons:
  apt:
    packages:
    - libc6-i386
    - lcov
    - doxygen

cache:
  directories:
  - $HOME/arm-gcc-toolchain

install:
  - ./install_arm_toolchain.sh
  - export PATH=$HOME/arm-gcc-toolchain/bin:$PATH

before_script:
  - arm-none-eabi-gcc --version

script:
  - ./build.sh

after_script:
  - ./build_unittests.sh
  - ./generate_coverage.sh
  - ./upload_report_ci.sh
  - ./upload_codecov.sh

deploy:
  - provider: releases
    api_key: $GITHUB_TOKEN
    file: "./squidDrone/build/SquidDrone.bin"
    skip_cleanup: true
    draft: true
    on:
      all_branches: true
  - provider: pages
    skip_cleanup: true
    local_dir: ./squidDrone/build/doc_doxygen/html
    github_token: $GITHUB_TOKEN
    on:
      branch: master